<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CRUD with Profile Images & Duplicate Check</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container mt-5">
  <h2 class="text-center mb-4 animate__animated animate__fadeInDown">CRUD â€“ Duplicate Check</h2>

  <div class="text-center mb-4">
    <button class="btn btn-success btn-lg" data-bs-toggle="modal" data-bs-target="#userModal">
      <i class="bi bi-plus-circle"></i> Add User
    </button>
  </div>

  <div class="table-responsive animate__animated animate__fadeIn" id="tableView">
    <table class="table table-hover text-center align-middle">
      <thead class="table-dark">
        <tr>
          <th>#</th>
          <th>Profile</th>
          <th>Name</th>
          <th>Email</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="userTable"></tbody>
    </table>
  </div>
</div>

<div class="modal fade" id="userModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content animate__animated animate__fadeInDown">
      <div class="modal-header">
        <h5 class="modal-title" id="modalTitle">Add User</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <input type="text" id="name" class="form-control mb-3" placeholder="Name">
        <input type="email" id="email" class="form-control mb-3" placeholder="Email">
        <input type="file" id="profileImage" class="form-control mb-3" accept="image/*">
        <img id="imagePreview" src="" class="img-thumbnail mb-2" style="display:none; width:80px; height:80px;">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" id="addBtn" class="btn btn-primary">Add User</button>
      </div>
    </div>
  </div>
</div>

<div class="position-fixed bottom-0 end-0 p-3" style="z-index:11">
  <div id="toastContainer"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="script.js"></script>
</body>
</html>


<style>
    body {
    background: linear-gradient(to right, #6a11cb, #2575fc);
    font-family: 'Arial', sans-serif;
    color: #fff;
    min-height: 100vh;
}

.modal-content {
    background: rgba(255,255,255,0.1);
    backdrop-filter: blur(10px);
    border-radius: 15px;
}

.table {
    background: rgba(255,255,255,0.1);
    border-radius: 10px;
}

img.profile {
    width: 50px;
    height: 50px;
    object-fit: cover;
    border-radius: 50%;
    border: 2px solid #fff;
}

button {transition: all 0.3s ease;}
button:hover {transform: scale(1.05);}

.toast {
    background: rgba(255,255,255,0.1);
    backdrop-filter: blur(8px);
    color: #fff;
    border-radius: 10px;
}

</style>


<script>
    let users = [];
let editIndex = null;

const nameInput = document.getElementById("name");
const emailInput = document.getElementById("email");
const profileInput = document.getElementById("profileImage");
const imagePreview = document.getElementById("imagePreview");
const addBtn = document.getElementById("addBtn");
const userTable = document.getElementById("userTable");
const modalTitle = document.getElementById("modalTitle");
const userModal = new bootstrap.Modal(document.getElementById('userModal'));
const toastContainer = document.getElementById("toastContainer");

// Show image preview
profileInput.addEventListener("change", () => {
    const file = profileInput.files[0];
    if(file){
        const reader = new FileReader();
        reader.onload = e => {
            imagePreview.src = e.target.result;
            imagePreview.style.display = "block";
        };
        reader.readAsDataURL(file);
    } else {
        imagePreview.src = "";
        imagePreview.style.display = "none";
    }
});

// Render table
function renderTable(){
    userTable.innerHTML = "";
    users.forEach((user,index)=>{
        userTable.innerHTML += `
        <tr class="animate__animated animate__fadeIn">
            <td>${index+1}</td>
            <td><img src="${user.image || 'https://via.placeholder.com/50'}" class="profile"></td>
            <td>${user.name}</td>
            <td>${user.email}</td>
            <td>
                <button class="btn btn-sm btn-warning me-2" onclick="editUser(${index})">
                    <i class="bi bi-pencil-square"></i>
                </button>
                <button class="btn btn-sm btn-danger" onclick="deleteUser(${index})">
                    <i class="bi bi-trash"></i>
                </button>
            </td>
        </tr>
        `;
    });
}

// Clear form
function clearForm(){
    nameInput.value = "";
    emailInput.value = "";
    profileInput.value = "";
    imagePreview.src = "";
    imagePreview.style.display = "none";
    addBtn.textContent = "Add User";
    modalTitle.textContent = "Add User";
    editIndex = null;
}

// Toast
function showToast(message,type="success"){
    const toastEl = document.createElement("div");
    toastEl.className = `toast align-items-center text-white bg-${type} border-0 animate__animated animate__bounceInRight`;
    toastEl.role="alert";
    toastEl.innerHTML = `
        <div class="d-flex">
            <div class="toast-body">${message}</div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>
    `;
    toastContainer.appendChild(toastEl);
    const bsToast = new bootstrap.Toast(toastEl,{delay:2000});
    bsToast.show();
    bsToast._element.addEventListener("hidden.bs.toast",()=>toastEl.remove());
}

// Check duplicate using AND condition (all three fields must match)
function isDuplicate(name,email,image){
    return users.some((user,idx)=>{
        if(editIndex!==null && idx===editIndex) return false; // skip current editing
        return user.name === name && user.email === email && user.image === image; // AND condition
    });
}

// Add / Update
addBtn.addEventListener("click", ()=>{
    const name = nameInput.value.trim();
    const email = emailInput.value.trim();
    const file = profileInput.files[0];

    if(!name || !email){
        alert("Enter name & email!");
        return;
    }

    if(file){
        const reader = new FileReader();
        reader.onload = e => {
            saveUser(name,email,e.target.result);
        };
        reader.readAsDataURL(file);
    } else {
        const existingImage = editIndex!==null ? users[editIndex].image : null;
        saveUser(name,email,existingImage);
    }
});

function saveUser(name,email,image){
    if(isDuplicate(name,email,image)){
        showToast("Duplicate entry not allowed!","warning");
        return;
    }
    if(editIndex===null){
        users.push({name,email,image});
        showToast("User added successfully!","success");
    } else {
        users[editIndex]={name,email,image};
        showToast("User updated successfully!","info");
    }
    renderTable();
    clearForm();
    userModal.hide();
}

// Edit
function editUser(index){
    const user = users[index];
    nameInput.value = user.name;
    emailInput.value = user.email;
    addBtn.textContent = "Update User";
    modalTitle.textContent = "Edit User";
    profileInput.value = "";
    imagePreview.src = user.image || "";
    imagePreview.style.display = user.image?"block":"none";
    editIndex=index;
    userModal.show();
}

// Delete
function deleteUser(index){
    if(confirm("Are you sure you want to delete this user?")){
        users.splice(index,1);
        renderTable();
        showToast("User deleted!","danger");
    }
}

</script>